{
	"name": "df_pred_presc_01",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_evs",
						"type": "DatasetReference"
					},
					"name": "sourceExcelevs"
				},
				{
					"dataset": {
						"referenceName": "ds_abs",
						"type": "DatasetReference"
					},
					"name": "sourceexcelabs"
				},
				{
					"dataset": {
						"referenceName": "ds_ipe",
						"type": "DatasetReference"
					},
					"name": "sourceexcelipe"
				},
				{
					"dataset": {
						"referenceName": "ds_leaves",
						"type": "DatasetReference"
					},
					"name": "sourceexcelleaves"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqldevplancore",
					"description": "[dataexporter].[devplan_core]"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqlrpttranscript",
					"description": "[reporting].[vw_rpt_transcript] \n"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqlrptusercf",
					"description": "[reporting].[vw_rpt_user_cf]"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqlsurveyresponse",
					"description": "[dbo].[SurveyResponse]\n"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqlhistoricalsnapshot",
					"description": "[datatransformation].[HistoricalSnapshot]"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcedbrptperformancereview"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqlsuccessionincumbent",
					"description": "vw_rpt_succession_incumbent_smp_cf"
				},
				{
					"dataset": {
						"referenceName": "ds_azure_table",
						"type": "DatasetReference"
					},
					"name": "sourcesqlrptuser",
					"description": "[reporting].[vw_rpt_user]"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_csv_file",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "aggregate1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          ID as string,",
				"          Respondents as string,",
				"          ResponseRate as string,",
				"          Culture as string,",
				"          {Culture  %Favorable} as string,",
				"          {Trust - Team} as string,",
				"          {Trust - Team  %Favorable} as string,",
				"          {Role Clarity Functional} as string,",
				"          {Role Clarity Functional  %Favorable} as string,",
				"          {Growth Functional} as string,",
				"          {Growth Functional  %Favorable} as string,",
				"          Career as string,",
				"          {Career  %Favorable} as string,",
				"          {Continuous Improvement Functional} as string,",
				"          {Continuous Improvement Functional  %Favorable} as string,",
				"          {Communication - Manager} as string,",
				"          {Communication - Manager  %Favorable} as string,",
				"          Support as string,",
				"          {Support  %Favorable} as string,",
				"          {Equal Opportunity} as string,",
				"          {Equal Opportunity  %Favorable} as string,",
				"          {Distress - Well-being} as string,",
				"          {Distress - Well-being  %Favorable} as string,",
				"          {Ethics Helpline} as string,",
				"          {Ethics Helpline  %Favorable} as string,",
				"          {Work Life Balance} as string,",
				"          {Work Life Balance  %Favorable} as string,",
				"          Growth as string,",
				"          {Growth  %Favorable} as string,",
				"          Cooperation as string,",
				"          {Cooperation  %Favorable} as string,",
				"          Initiative as string,",
				"          {Initiative  %Favorable} as string,",
				"          {Decision Making} as string,",
				"          {Decision Making  %Favorable} as string,",
				"          {Engagement Index} as string,",
				"          {Engagement Index  %Favorable} as string,",
				"          {Engagement Index > Recommend} as string,",
				"          {Engagement Index > Recommend  %Favorable} as string,",
				"          {Role Clarity} as string,",
				"          {Role Clarity  %Favorable} as string,",
				"          Resources as string,",
				"          {Resources  %Favorable} as string,",
				"          {Engagement Index > eSat} as string,",
				"          {Engagement Index > eSat  %Favorable} as string,",
				"          Belonging as string,",
				"          {Belonging  %Favorable} as string,",
				"          Prospects as string,",
				"          {Prospects  %Favorable} as string,",
				"          {Purpose Contribution} as string,",
				"          {Purpose Contribution  %Favorable} as string,",
				"          {Inclusion - Team} as string,",
				"          {Inclusion - Team  %Favorable} as string,",
				"          {Job Feedback} as string,",
				"          {Job Feedback  %Favorable} as string,",
				"          {Consumer Focus - Culture} as string,",
				"          {Consumer Focus - Culture  %Favorable} as string,",
				"          {Non-Discrimination} as string,",
				"          {Non-Discrimination  %Favorable} as string,",
				"          {Code of Conduct} as string,",
				"          {Code of Conduct  %Favorable} as string,",
				"          {Health & Safety} as string,",
				"          {Health & Safety  %Favorable} as string,",
				"          {Continuous Improvement} as string,",
				"          {Continuous Improvement  %Favorable} as string,",
				"          Empowerment as string,",
				"          {Empowerment  %Favorable} as string,",
				"          Environment as string,",
				"          {Environment  %Favorable} as string,",
				"          Purpose as string,",
				"          {Purpose  %Favorable} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> sourceExcelevs",
				"source(output(",
				"          {User First Name} as string,",
				"          {User Last Name} as string,",
				"          {User ID} as string,",
				"          {Local system ID} as string,",
				"          Type as string,",
				"          Status as string,",
				"          {Date changed} as string,",
				"          {Date effective} as string,",
				"          {Field modified} as string,",
				"          {Field type} as string,",
				"          {Field changed from} as string,",
				"          {Field changed to} as string,",
				"          {Field changed by} as string,",
				"          {Reason for change} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> sourceexcelabs",
				"source(output(",
				"          {User First Name} as string,",
				"          {User Last Name} as string,",
				"          {User ID} as string,",
				"          {Local system ID} as string,",
				"          Type as string,",
				"          Status as string,",
				"          {Date changed} as string,",
				"          {Date effective} as date 'dd/MM/yyyy',",
				"          {Field modified} as string,",
				"          {Field type} as string,",
				"          {Field changed from} as string,",
				"          {Field changed to} as string,",
				"          {Field changed by} as string,",
				"          {Reason for change} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> sourceexcelipe",
				"source(output(",
				"          ID as string,",
				"          Respondents as string,",
				"          ResponseRate as string,",
				"          Culture as string,",
				"          {Culture  %Favorable} as string,",
				"          {Trust - Team} as string,",
				"          {Trust - Team  %Favorable} as string,",
				"          {Role Clarity Functional} as string,",
				"          {Role Clarity Functional  %Favorable} as string,",
				"          {Growth Functional} as string,",
				"          {Growth Functional  %Favorable} as string,",
				"          Career as string,",
				"          {Career  %Favorable} as string,",
				"          {Continuous Improvement Functional} as string,",
				"          {Continuous Improvement Functional  %Favorable} as string,",
				"          {Communication - Manager} as string,",
				"          {Communication - Manager  %Favorable} as string,",
				"          Support as string,",
				"          {Support  %Favorable} as string,",
				"          {Equal Opportunity} as string,",
				"          {Equal Opportunity  %Favorable} as string,",
				"          {Distress - Well-being} as string,",
				"          {Distress - Well-being  %Favorable} as string,",
				"          {Ethics Helpline} as string,",
				"          {Ethics Helpline  %Favorable} as string,",
				"          {Work Life Balance} as string,",
				"          {Work Life Balance  %Favorable} as string,",
				"          Growth as string,",
				"          {Growth  %Favorable} as string,",
				"          Cooperation as string,",
				"          {Cooperation  %Favorable} as string,",
				"          Initiative as string,",
				"          {Initiative  %Favorable} as string,",
				"          {Decision Making} as string,",
				"          {Decision Making  %Favorable} as string,",
				"          {Engagement Index} as string,",
				"          {Engagement Index  %Favorable} as string,",
				"          {Engagement Index > Recommend} as string,",
				"          {Engagement Index > Recommend  %Favorable} as string,",
				"          {Role Clarity} as string,",
				"          {Role Clarity  %Favorable} as string,",
				"          Resources as string,",
				"          {Resources  %Favorable} as string,",
				"          {Engagement Index > eSat} as string,",
				"          {Engagement Index > eSat  %Favorable} as string,",
				"          Belonging as string,",
				"          {Belonging  %Favorable} as string,",
				"          Prospects as string,",
				"          {Prospects  %Favorable} as string,",
				"          {Purpose Contribution} as string,",
				"          {Purpose Contribution  %Favorable} as string,",
				"          {Inclusion - Team} as string,",
				"          {Inclusion - Team  %Favorable} as string,",
				"          {Job Feedback} as string,",
				"          {Job Feedback  %Favorable} as string,",
				"          {Consumer Focus - Culture} as string,",
				"          {Consumer Focus - Culture  %Favorable} as string,",
				"          {Non-Discrimination} as string,",
				"          {Non-Discrimination  %Favorable} as string,",
				"          {Code of Conduct} as string,",
				"          {Code of Conduct  %Favorable} as string,",
				"          {Health & Safety} as string,",
				"          {Health & Safety  %Favorable} as string,",
				"          {Continuous Improvement} as string,",
				"          {Continuous Improvement  %Favorable} as string,",
				"          Empowerment as string,",
				"          {Empowerment  %Favorable} as string,",
				"          Environment as string,",
				"          {Environment  %Favorable} as string,",
				"          Purpose as string,",
				"          {Purpose  %Favorable} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> sourceexcelleaves",
				"source(output(",
				"          count_devplan_id as integer,",
				"          assigned_user_id as integer,",
				"          year as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT count( distinct [devplan_id]) count_devplan_id,\\n      [assigned_user_id],year(devplan_created_dt) year\\n      FROM [dataexporter].[devplan_core] group by\\n  year(devplan_created_dt),[assigned_user_id]',",
				"     format: 'query') ~> sourcesqldevplancore",
				"source(output(",
				"          count_transc_obj_id as integer,",
				"          year as integer,",
				"          trans_user_id as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT count(distinct transc_object_id) count_transc_obj_id\\n      ,year([user_lo_create_dt]) year    \\n      ,[transc_user_id] trans_user_id     \\n  FROM [reporting].[vw_rpt_transcript] where year([user_lo_create_dt])>2018 \\n  group by year([user_lo_create_dt])    \\n      ,[transc_user_id] \\n',",
				"     format: 'query') ~> sourcesqlrpttranscript",
				"source(output(",
				"          user_cf_user_id as integer,",
				"          current_abs_compa_ratio as double,",
				"          current_ttc_compa_ratio as double",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT [user_cf_user_id]     \\n      ,[current_abs_compa_ratio]     \\n      ,[current_ttc_compa_ratio]     \\n  FROM [reporting].[vw_rpt_user_cf] where current_abs_compa_ratio is not null',",
				"     format: 'query') ~> sourcesqlrptusercf",
				"source(output(",
				"          RespondersEmail as string,",
				"          QuestionTitle as string,",
				"          Answer as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT \\n      [RespondersEmail]      \\n      ,[QuestionTitle]     \\n      ,[Answer]\\n  FROM [dbo].[SurveyResponse] where CreatedBy like \\'%ee4%\\' and QuestionID=\\'4\\'',",
				"     format: 'query') ~> sourcesqlsurveyresponse",
				"source(output(",
				"          Id as long,",
				"          user_id as string,",
				"          division as string,",
				"          job_family as string,",
				"          functional_area as string,",
				"          reason_for_leaving as string,",
				"          termination_type as string,",
				"          termination_date as timestamp,",
				"          original_hire_date as timestamp,",
				"          electrolux_legal_entity as string,",
				"          organizational_area as string,",
				"          region as string,",
				"          tier_level as integer,",
				"          job_level_sub_band as string,",
				"          job_level_band as string,",
				"          employee_nationality as string,",
				"          is_line_manager as string,",
				"          country_of_location as string,",
				"          employee_type as string,",
				"          date_of_birth as timestamp,",
				"          employee_gender as string,",
				"          job_family_id as integer,",
				"          job_family_ref as string,",
				"          manager_id as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: '\\nSELECT [Id]\\n      ,[user_id]\\n      ,[division]\\n      ,[job_family]\\n      ,[functional_area]\\n      ,[reason_for_leaving]\\n      ,[termination_type]\\n      ,[termination_date]\\n      ,[original_hire_date]\\n      ,[electrolux_legal_entity]\\n      ,[organizational_area]\\n      ,[region]\\n      ,[tier_level]\\n      ,[job_level_sub_band]\\n      ,[job_level_band]\\n      ,[employee_nationality]\\n      ,[is_line_manager]\\n      ,[country_of_location]\\n      ,[employee_type]\\n      ,[date_of_birth]\\n      ,[employee_gender]\\n      ,[job_family_id]\\n      ,[job_family_ref]\\n      ,[manager_id]\\n  FROM [datatransformation].[HistoricalSnapshot]\\n',",
				"     format: 'query') ~> sourcesqlhistoricalsnapshot",
				"source(output(",
				"          user_id as integer,",
				"          year as string,",
				"          task_user_override as decimal(18,2)",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT [user_id]\\n      ,right([task_name],4) year\\n      ,[task_user_override]\\n        FROM [reporting].[vw_rpt_performance_review]',",
				"     format: 'query') ~> sourcedbrptperformancereview",
				"source(output(",
				"          user_id as integer,",
				"          task_id as integer,",
				"          rating as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT [warehouse_smp_custom_fields_user_id] user_id\\n      ,[warehouse_smp_custom_fields_task_id] task_id\\n      ,RIGHT([smp_custom_field_02133],4) rating\\n  FROM [reporting].[vw_rpt_succession_incumbent_smp_cf]',",
				"     format: 'query') ~> sourcesqlsuccessionincumbent",
				"source(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'with temp as (SELECT distinct\\n      I.[ou_id]  \\n      ,I.[ref]\\n     , O.title    \\n  FROM [reporting].[vw_rpt_ou] I\\n  inner join [reporting].[vw_rpt_ou_title_local] O\\n  on I.[ou_id]=O.[ou_id]\\n  where culture_id=2 )     \\n,Email as\\n(select distinct \\nuser_id AS User_ID2,\\nuser_ref AS USER_Ref2,\\nuser_email AS U_email,\\nUI.individual_ipe_ref AS UserIPE,\\nUS.usl_title AS [User Status]\\nfrom [reporting].[vw_rpt_user] U (nolock) \\ninner join [reporting].[vw_rpt_user_ou_info] UI ON U.user_id=UI.user_ou_info_user_id\\nInner join [datatransformation].[OuDivisionHierarchy] T ON T.ou_id=UI.user_ou_id_division\\nLeft join [reporting].[vw_rpt_user_status_local] US ON U.user_status_id =US.usl_status_id and US.culture_id=2)\\nselect\\nUser_id as [User ID Technical],\\nuser_ref as [User Id],\\nuser_mgr_ref as [Manager Ref]\\nfrom [reporting].[vw_rpt_user] U\\nInner join [reporting].[vw_rpt_user_ou_info] UI ON U.user_id=UI.user_ou_info_user_id\\nInner join [datatransformation].[OuDivisionHierarchy] T ON T.ou_id=UI.user_ou_id_division\\nLeft join [reporting].[vw_rpt_user_cf] UCF on U.user_id=UCF.user_cf_user_id\\nLeft join [reporting].[vw_rpt_user_status_local] US ON U.user_status_id =US.usl_status_id and US.culture_id=2\\nLeft Join email E3 ON U.user_mgr_id=E3.User_ID2\\nLeft join Temp Region on Region.ou_id=UI.user_ou_id_region\\nLeft join Temp Tier on Tier.ou_id =UI.user_ou_id_tier_level\\nLeft join Temp Div on div.ou_id=UI.user_ou_id_division \\nLeft join Temp Loc on Loc.ou_id=UI.user_ou_id_location\\nLeft join Temp CP on CP.ou_id=UI.user_ou_id_country_of_payroll\\nLeft join Temp JF  on JF.ou_id=UI.user_ou_id_job_family\\nLeft join Temp AJ on AJ.ou_id=UI.user_ou_id_anchor_job\\nLeft join Temp OA on OA.ou_id=UI.user_ou_id_organizational_area\\nLEFT JOIN [datatransformation].[SectorMapping] ORG ON OA.title=ORG.OrganizationalAreaOld\\nLeft join Temp FA on FA.ou_id=UI.user_ou_id_functional_area\\nLeft join Temp IP on IP.ou_id=UI.user_ou_id_individual_ipe\\nLeft join Temp ELE on ELE.ou_id=UI.user_ou_id_electrolux_legal_entity\\nLeft join Temp JL on JL.ou_id=UI.user_ou_id_job_level_sub_band\\nLeft join Temp SS on SS.ou_id=UI.user_ou_id_salary_structure\\nLeft join Temp EF on EF.ou_id=UI.user_ou_id_electrolux_function\\nLeft join [reporting].[vw_rpt_user_dynamic_relation] DR ON U.user_id=DR.user_dynamic_relation_user_id\\nLeft Join email E1 On DR.operational_hrbp_ref=E1.USER_Ref2\\nLeft Join email E2 On E2.USER_Ref2=DR.functional_hrbp_ref\\nLeft join [reporting].[vw_rpt_user_category_local] CL ON U.user_category_id=CL.ucl_user_category_id  and CL.culture_id=2\\nLeft join [reporting].[vw_rpt_user_sub_category_local] SCL on U.user_sub_category_id=SCL.uscl_user_sub_category_id and SCL.culture_id=2\\nLeft join [reporting].[vw_rpt_user_employment_status_local] EMP ON U.user_employment_status_id=EMP.uesl_user_employment_status_id and EMP.culture_id=2\\nLeft join [reporting].[vw_rpt_user_termination_reason_local] TRL ON U.user_termination_reason_id=TRL.utrl_user_termination_reason_id and TRL.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] EC on UCF.employee_class_id=EC.cfvl_value_id and EC.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] ET on UCF.employee_type_id=ET.cfvl_value_id AND ET.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] FT on UCF.full_time_part_time_id=FT.cfvl_value_id and FT.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] EG on UCF.employee_gender_id=EG.cfvl_value_id and EG.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] EN on UCF.employee_nationality_id=EN.cfvl_value_id and EN.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] VPT on UCF.variable_pay_type_id=VPT.cfvl_value_id and VPT.culture_id=2\\nLeft join [reporting].[vw_rpt_custom_field_value_local] AB on UCF.compensation_currency_code_id=AB.cfvl_value_id and AB.culture_id=2\\nLeft join [reporting].[vw_rpt_user_leave_reason_local] LR ON U.user_leave_reason_id=LR.ulrl_user_leave_reason_id AND LR.culture_id=2\\nwhere coalesce(EMP.uesl_title,\\'\\')<>\\'Onboarding\\' and coalesce(ui.user_ou_id_organizational_area,\\'\\')<>\\'7382\\' \\nand coalesce(TRL.utrl_title,\\'\\')<>\\'Spin off\\' and U.user_status_id in (1,2)',",
				"     format: 'query') ~> sourcesqlrptuser",
				"sourceexcelipe aggregate(groupBy({User ID}),",
				"     {Date effective} = max({Date effective})) ~> aggregate1",
				"sourceExcelevs sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sink1"
			]
		}
	}
}